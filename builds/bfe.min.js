/* bfe 2018-03-30 */!function(){function a(a){var b=function(a,b){return e("",a,b)},f=c;a&&(c[a]||(c[a]={}),f=c[a]),f.define&&f.define.packaged||(d.original=f.define,f.define=d,f.define.packaged=!0),f.require&&f.require.packaged||(e.original=f.require,f.require=b,f.require.packaged=!0)}var b="bfe",c=function(){return this}();if(b||"undefined"==typeof requirejs){var d=function(a,b,c){if("string"!=typeof a)return void(d.original?d.original.apply(window,arguments):(console.error("dropping module because define wasn't a string."),console.trace()));2==arguments.length&&(c=b),d.modules||(d.modules={},d.payloads={}),d.payloads[a]=c,d.modules[a]=null},e=function(a,b,c){if("[object Array]"===Object.prototype.toString.call(b)){for(var d=[],f=0,h=b.length;f<h;++f){var i=g(a,b[f]);if(!i&&e.original)return e.original.apply(window,arguments);d.push(i)}c&&c.apply(null,d)}else{if("string"==typeof b){var j=g(a,b);return!j&&e.original?e.original.apply(window,arguments):(c&&c(),j)}if(e.original)return e.original.apply(window,arguments)}},f=function(a,b){if(-1!==b.indexOf("!")){var c=b.split("!");return f(a,c[0])+"!"+f(a,c[1])}if("."==b.charAt(0)){var d=a.split("/").slice(0,-1).join("/");for(b=d+"/"+b;-1!==b.indexOf(".")&&e!=b;){var e=b;b=b.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return b},g=function(a,b){b=f(a,b);var c=d.modules[b];if(!c){if("function"==typeof(c=d.payloads[b])){var g={},h={id:b,uri:"",exports:g,packaged:!0};g=c(function(a,c){return e(b,a,c)},g,h)||h.exports,d.modules[b]=g,delete d.payloads[b]}c=d.modules[b]=g||c}return c};a(b)}}(),bfe.define("src/bfe",["require","exports","module","src/lib/jquery-2.1.0.min","src/lib/json","src/lib/lodash.min","src/lib/bootstrap.min","src/lib/typeahead.jquery.min","src/bfestore","src/bfelogging","src/lookups/lcnames","src/lookups/lcsubjects","src/lookups/lcgenreforms","src/lookups/lcworks","src/lookups/lcinstances","src/lookups/lcorganizations","src/lookups/lccountries","src/lookups/lcgacs","src/lookups/lclanguages","src/lookups/lcidentifiers","src/lookups/lctargetaudiences","src/lookups/iso6391","src/lookups/iso6392","src/lookups/iso6395","src/lookups/rdacontenttypes","src/lookups/rdamediatypes","src/lookups/rdacarriers","src/lookups/rdamodeissue","src/lookups/lcrelators","src/lookups/lcperformanceMediums","src/lookups/rdamusnotation","src/lookups/rdaformatnotemus","src/lib/aceconfig"],function(a,b,c){function d(a){if(void 0!==a.scheme){z.addMsg(new Error,"INFO","Setting up scheme "+a.scheme);var b=config.lookups[a.scheme];H[a.scheme]={},H[a.scheme].name=b.name,H[a.scheme].load=a}else z.addMsg(new Error,"WARN","Loading lookup FAILED",a);f()}function e(a){$.get("/api/");var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function f(){if($("#bfeditor-loader").width($("#bfeditor-loader").width()+5+"%"),++F>=E&&($("#bfeditor-formdiv").html(""),D.length>0)){z.addMsg(new Error,"DEBUG","Loading selected template(s)",D);var a=h(D);$(".typeahead",a.form).each(function(){p(this)});var b=$('<div class="btn-group pull-right">                     <button id="bfeditor-exitcancel" type="button" class="btn btn-default">Cancel</button>                     <button id="bfeditor-exitpreview" type="button" class="btn btn-primary">Preview</button>                 </div>');a.form.append(b),$("#bfeditor-exitcancel",a.form).click(function(){$("#bfeditor > .row").remove(),$("#bfeditor > .footer").remove(),bfeditor=bfe.fulleditor(config,"bfeditor")}),$("#bfeditor-exitcancel",a.form).attr("tabindex",C++),$("#bfeditor-exitpreview",a.form).click(function(){var a=bfeditor.bfestore.store2text(),b=bfeditor.bfestore.store2jsonldExpanded();document.body.scrollTop=document.documentElement.scrollTop=0;var c=$('<div class="btn-group" id="save-btn">                          <button id="bfeditor-exitback" type="button" class="btn btn-default">Back</button>                          <button id="bfeditor-exitsave" type="button" class="btn btn-primary">Save</button>                          </div>'),d=$("#bfeditor > .row"),f=$('<div id="bfeditor-preview" class="col-md-10 main panel-group">                         <div class="panel panel-default"><div class="panel-heading">                         <h3 class="panel-title"><a role="button" data-toggle="collapse" href="#humanized">Preview</a></h3></div>                         <div class="panel-collapse collapse in" id="humanized"><div class="panel-body"><pre>'+a+'</pre></div></div>                         <div class="panel panel-default"><div class="panel-heading"><h3 class="panel-title"><a role="button" data-toggle="collapse" href="#jsonld">JSONLD-Expanded</a></h3></div>                         <div class="panel-collapse collapse in" id="jsonld"><div class="panel-body"><pre>'+JSON.stringify(b,void 0," ")+"</pre></div></div></div>                         </div>");d.append(c),$("#bfeditor-exitback").click(function(){$("#save-btn").remove(),$("#bfeditor-preview").remove(),$("#bfeditor-formdiv").show()}),$("#bfeditor-exitsave").click(function(){if(void 0!==x.save.callback)x.save.callback(y.store2jsonldExpanded(),e("csrftoken"));else{$("#bfeditor > .row").remove(),$("#bfeditor > .footer").remove(),$("#bfeditor-debugdiv").remove(),bfeditor=bfe.fulleditor(config,"bfeditor");var a=$("<div>",{id:"bfeditor-messagediv"});a.append('<span class="str"><h3>Save disabled</h3></span>'),$("#bfeditor-formdiv").append(a)}}),$("#bfeditor-formdiv").hide(),d.append(f)}),$("#bfeditor-exitpreview",a.form).attr("tabindex",C++),$("#bfeditor-formdiv").html(""),$("#bfeditor-formdiv").append(a.form),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," ")),$("#bfeditor-debug").html(JSON.stringify(z.getLog(),void 0," "))}}function g(a){spnums=a.replace("sp-","").split("_"),spoints=x.startingPoints[spnums[0]].menuItems[spnums[1]],y.store=[],loadtemplatesCounter=0,loadtemplatesCount=spoints.useResourceTemplates.length,D=[],spoints.useResourceTemplates.forEach(function(a){var b=u(),c={},d=[];c.templateGUID=b,c.resourceTemplateID=a,c.embedType="page",c.data=d,D.push(c),f()})}function h(a){var b,c=u(),d={};d.id=c,d.store=[],d.resourceTemplates=[],d.resourceTemplateIDs=[],d.formTemplates=[];for(var e=0;e<a.length;e++){var b=_.where(B,{id:a[e].resourceTemplateID});void 0!==b&&void 0!==b[0]?(d.resourceTemplates[e]=JSON.parse(JSON.stringify(b[0])),d.resourceTemplates[e].data=a[e].data,d.resourceTemplates[e].defaulturi=a[e].resourceURI,d.resourceTemplates[e].useguid=a[e].templateGUID,d.resourceTemplates[e].embedType=a[e].embedType,void 0===d.resourceTemplates[e].defaulturi&&(d.resourceTemplates[e].defaulturi=v(d.resourceTemplates[e],x.baseURI)+a[e].templateGUID),d.resourceTemplateIDs[e]=b[0].id):z.addMsg(new Error,"WARN","Unable to locate resourceTemplate. Verify the resourceTemplate ID is correct.")}var f=$("<form>",{id:"bfeditor-form-"+d.id,class:"form-horizontal",role:"form"}),g=!0;return d.resourceTemplates.forEach(function(a){z.addMsg(new Error,"DEBUG","Creating form for: "+a.id,a);var b=$("<div>",{id:a.useguid,"data-uri":a.defaulturi}),c=$("<h3>"+a.resourceLabel+"</h3>");b.append(c),a.propertyTemplates.forEach(function(c){var e=u();c.guid=e,c.display="true";var f=$("<div>",{class:"form-group row"}),h=$('<div class="form-group row"><div class="btn-toolbar col-sm-12" role="toolbar"></div></div></div>');if(/^http/.test(c.remark))var i=$('<label for="'+c.guid+'" class="col-sm-3 control-label" title="'+c.remark+'"><a href="'+c.remark+'" target="_blank">'+c.propertyLabel+"</a></label>");else var i=$('<label for="'+c.guid+'" class="col-sm-3 control-label" title="'+c.remark+'">'+c.propertyLabel+"</label>");if("literal"==c.type){var k=$('<div class="col-sm-8"><input type="text" class="form-control" id="'+c.guid+'" placeholder="'+c.propertyLabel+'" tabindex="'+C+++'"></div>');k.find("input").keyup(function(a){if(54==a.keyCode&&a.ctrlKey&&a.altKey){var b=this.value;this.value=b+"©"}else 53==a.keyCode&&a.ctrlKey&&a.altKey&&(this.value=this.value+"℗")}),$button=$('<div class="btn-group btn-group-md span1"><button type="button" class="btn btn-default" tabindex="'+C+++'">&#10133;</button></div>'),$button.click(function(){n(d.id,a.useguid,c.guid)});var l=function(b){13==b.keyCode&&(n(d.id,a.useguid,c.guid),$("#"+c.guid).parent().parent().next().find("input:not('.tt-hint')").length?$("#"+c.guid).parent().parent().next().find("input:not('.tt-hint')").focus():$("[id^=bfeditor-modalSave]").focus())};k.keyup(l),f.append(i),k.append(h),f.append(k),f.append($button)}if("resource"==c.type)if(_.has(c,"valueConstraint"))if(_.has(c.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(c.valueConstraint.valueTemplateRefs)){$buttondiv=$('<div class="col-sm-8" id="'+c.guid+'"></div>'),$buttongrp=$('<div class="btn-group btn-group-md"></div>');for(var m=c.valueConstraint.valueTemplateRefs,p=0;p<m.length;p++){var q=m[p],r=_.where(B,{id:q});if(void 0!==r[0]){var s=r[0],t=$('<button type="button" class="btn btn-default" tabindex="'+C+++'">'+s.resourceLabel+"</button>"),v=d.id,w=(a.useguid,c.guid),x="_:bnode"+u();t.click({fobjectid:v,newResourceURI:x,propertyguid:w,template:s},function(a){var b="_:bnode"+u();j(a.data.fobjectid,a.data.template,b,a.data.propertyguid,[])}),$buttongrp.append(t)}}$buttondiv.append($buttongrp),f.append(i),$buttondiv.append(h),f.append($buttondiv)}else if(_.has(c.valueConstraint,"useValuesFrom")){if("modal"!=a.embedType&&g&&c.propertyLabel.match(/lookup/i))return void(g=!1);var y=$('<div class="col-sm-8"></div>'),k=$('<input type="text" class="typeahead form-control" data-propertyguid="'+c.guid+'" id="'+c.guid+'" placeholder="'+c.propertyLabel+'" tabindex="'+C+++'">'),z=$('<input type="hidden" id="'+c.guid+'_page" class="typeaheadpage" value="1">');if(y.append(k),y.append(z),k.on("focus",function(){""===$(this).val()&&$(this).data().ttTypeahead.input.trigger("queryChanged","")}),f.append(i),y.append(h),f.append(y),"modal"==a.embedType&&g&&c.propertyLabel.match(/lookup/i)){var A=$('<div class="modal-header" style="text-align: right;"><button type="button" class="btn btn-primary" id="bfeditor-modalSaveLookup-'+d.id+'" tabindex="'+C+++'">Save changes</button></div>'),D=$('<div class="modal-header" style="text-align: center;"><h2>OR</h2></div>');f.append(A),f.append(D)}}else{var k=$('<div class="col-sm-8"><input class="form-control" id="'+c.guid+'" placeholder="'+c.propertyLabel+'" tabindex="'+C+++'"></div>');$button=$('<div class="col-sm-1"><button type="button" class="btn btn-default" tabindex="'+C+++'">Set</button></div>'),$button.click(function(){o(d.id,a.useguid,c.guid)}),f.append(i),k.append(h),f.append(k),f.append($button)}else{var k=$('<div class="col-sm-8"><input class="form-control" id="'+c.guid+'" placeholder="'+c.propertyLabel+'" tabindex="'+C+++'"></div>');$button=$('<div class="col-sm-1"><button type="button" class="btn btn-default" tabindex="'+C+++'">Set</button></div>'),$button.click(function(){o(d.id,a.useguid,c.guid)}),f.append(i),k.append(h),f.append(k),f.append($button)}b.append(f),g=!1}),f.append(b)}),d.resourceTemplates.forEach(function(a){if(0===a.data.length){var b;u();b=void 0!==a.defaulturi&&""!==a.defaulturi?a.defaulturi:x.baseURI+a.useguid;var c={};c.guid=a.useguid,c.rtID=a.id,c.s=b,c.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",c.o=a.resourceURI,c.otype="uri",d.store.push(c),y.store.push(c),a.guid=a.useguid,a.propertyTemplates.forEach(function(e){if(_.has(e,"valueConstraint")&&_.has(e.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(e.valueConstraint.valueTemplateRefs))for(var f=e.valueConstraint.valueTemplateRefs,g=0;g<f.length;g++){var h=f[g];if(d.resourceTemplateIDs.indexOf(h)>-1&&h!=a.id){var i=_.where(y.store,{rtID:h});c={},c.guid=u(),c.s=b,c.p=e.propertyURI,c.o=i[0].s,c.otype="uri",d.store.push(c),y.store.push(c),e.display="false"}}})}else a.data.forEach(function(a){var b={};b=a,void 0===b.guid&&(b.guid=u()),d.store.push(b)});z.addMsg(new Error,"DEBUG","Populating form with pre-loaded data, if any"),a.propertyTemplates.forEach(function(b){var c=_.where(y.store,{s:a.defaulturi,p:b.propertyURI});if(void 0!==c[0])z.addMsg(new Error,"DEBUG","Found pre-loaded data for "+b.propertyURI),c.forEach(function(a){var c=$("#"+b.guid,f).closest(".form-group"),e=c.find(".btn-toolbar").eq(0),g="",h=[];if("uri"==a.otype){var h=_.where(y.store,{s:a.o});g=a.o;var i="";h.length>0&&h.forEach(function(a){""==i&&"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==a.p&&(i=a.o);var c="";if(""!=i&&_.has(b,"valueConstraint")&&_.has(b.valueConstraint,"valueTemplateRefs")&&!_.isEmpty(b.valueConstraint.valueTemplateRefs)){_.where(B,{resourceURI:i}).forEach(function(d){""==c&&-1!==_.indexOf(b.valueConstraint.valueTemplateRefs,d.id)&&(z.addMsg(new Error,"DEBUG","Assocating one resource with another from loaded templates"),c=d.id,a.rtID=d.id)})}d.store.push(a),a.p.match(/label|authorizedAccessPoint/i)&&(g=a.o)})}else g=a.o;""==g&&(g=a.s),h.push(a);var j={tguid:a.guid,tlabelhover:g,tlabel:g,fobjectid:d.id,inputid:b.guid,triples:h},k=m(j);if(e.append(k),void 0!==b.valueConstraint&&void 0!==b.valueConstraint.repeatable&&"false"==b.valueConstraint.repeatable){var l=$("#"+b.guid,f);if(l.is("input"))l.prop("disabled",!0);else{$("div.btn-group",l).find("button").each(function(){$(this).prop("disabled",!0)})}}});else if(_.has(b,"valueConstraint")&&_.has(b.valueConstraint,"defaultURI")&&!_.isEmpty(b.valueConstraint.defaultURI)){z.addMsg(new Error,"DEBUG","Setting default data for "+b.propertyURI);var e=b.valueConstraint.defaultURI,g={};g.guid=u(),void 0!==a.defaulturi&&""!==a.defaulturi?g.s=a.defaulturi:g.s=x.baseURI+a.useguid,g.p=b.propertyURI,g.o=e,g.otype="uri",d.store.push(g),y.store.push(g);var h={};h.s=g.o,h.otype="literal",h.p="http://bibframe.org/vocab/label",h.o=b.valueConstraint.defaultLiteral,d.store.push(h),y.store.push(h);var i=$("#"+b.guid,f).closest(".form-group"),j=i.find(".btn-toolbar").eq(0),k="";_.has(b.valueConstraint,"defaultLiteral")&&(k=b.valueConstraint.defaultLiteral),displaydata=k;var l=!0;void 0!==b.valueConstraint.editable&&"false"===b.valueConstraint.editable&&(l=!1);var n={tguid:g.guid,tlabelhover:displaydata,tlabel:displaydata,fobjectid:d.id,inputid:b.guid,editable:l,triples:[h]},o=m(n);if(j.append(o),void 0!==b.valueConstraint.repeatable&&"false"==b.valueConstraint.repeatable){var p=$("#"+b.guid,f);if(p.is("input"))p.prop("disabled",!0);else{var q=$("div.btn-group",p).find("button");q.each(function(){$(this).prop("disabled",!0)})}}}})}),G.push(d),z.addMsg(new Error,"DEBUG","Newly created formobject.",d),{formobject:d,form:f}}function j(a,b,c,d,e){var f='<div class="modal fade" id="bfeditor-modal-modalID" tabindex="'+C+++'" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">             <div class="modal-dialog">                 <div class="modal-content">                     <div class="modal-header">                         <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>                         <h4 class="modal-title" id="bfeditor-modaltitle-modalID">Modal title</h4>                     </div>                     <div class="modal-body" id="bfeditor-modalbody-modalID"></div>                     <div class="modal-footer">                         <button type="button" class="btn btn-default" id="bfeditor-modalCancel-modalID" data-dismiss="modal">Cancel</button>                         <button type="button" class="btn btn-primary" id="bfeditor-modalSave-modalID">Save changes</button>                     </div>                 </div>             </div>         </div> ';z.addMsg(new Error,"DEBUG","Opening modal for resourceURI "+c),z.addMsg(new Error,"DEBUG","inputID of DOM element / property when opening modal: "+d),z.addMsg(new Error,"DEBUG","callingformobjectid when opening modal: "+a);var g=u(),i=[];if(0===e.length){var j=_.where(G,{id:a});j=j[0],j.resourceTemplates.forEach(function(a){var e=_.where(a.propertyTemplates,{guid:d});if(void 0!==e[0]){var f={};f.s=a.defaulturi,f.p=e[0].propertyURI,f.o=c,f.otype="uri",i.push(f),f={},f.s=c,f.rtID=b.id,f.p="http://www.w3.org/1999/02/22-rdf-syntax-ns#type",f.o=b.resourceURI,f.otype="uri",i.push(f)}})}else i=e;z.addMsg(new Error,"DEBUG","triplespassed within modal",i);var k=h([{templateGUID:g,resourceTemplateID:b.id,resourceURI:c,embedType:"modal",data:i}]),m=f.replace(/modalID/g,k.formobject.id);m=$(m),$(w).append(m),$("#bfeditor-modalbody-"+k.formobject.id).append(k.form),$("#bfeditor-modaltitle-"+k.formobject.id).html(b.resourceLabel),$("#bfeditor-modal-"+k.formobject.id).modal("show"),$("#bfeditor-modalCancel-"+k.formobject.id).attr("tabindex",C++),$("#bfeditor-modalSave-"+k.formobject.id).click(function(){e.forEach(function(b){s(a,d,null,b)}),k.formobject.store.length<=2?($("#bfeditor-modalSave-"+k.formobject.id).off("click"),$("#bfeditor-modal-"+k.formobject.id).modal("hide")):l(a,k.formobject.id,c,d,k.formobject.store)}),$("#bfeditor-modalSave-"+k.formobject.id).attr("tabindex",C++),$("#bfeditor-modalSaveLookup-"+k.formobject.id).click(function(){e.forEach(function(b){s(a,d,null,b)}),l(a,k.formobject.id,c,d,k.formobject.store)}),$("#bfeditor-modal-"+k.formobject.id).on("hide.bs.modal",function(a){$(this).empty()}),$(".typeahead",k.form).each(function(){p(this)}),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," ")),$("#bfeditor-modal-"+k.formobject.id+" input:not('.tt-hint'):first").focus()}function l(a,b,c,d,e){z.addMsg(new Error,"DEBUG","Setting resource from modal"),z.addMsg(new Error,"DEBUG","modal form id is: "+b);var f=_.where(G,{id:a});f=f[0],f.resourceTemplates.forEach(function(b){var c=_.where(b.propertyTemplates,{guid:d});if(void 0!==c[0]){z.addMsg(new Error,"DEBUG","Data from modal: ",e),e.forEach(function(a){f.store.push(a),y.store.push(a)}),y.storeDedup();var g=$("#"+d,f.form).closest(".form-group"),h=g.find(".btn-toolbar")[0];if(z.addMsg(new Error,"DEBUG","Selected property from calling form: "+c[0].propertyURI),tlabel=_.find(e,function(a){if(a.p.match(/label|authorizedAccessPoint|^title$|titleValue/i))return a.o}),void 0!==tlabel)j=tlabel.o,displayuri=tlabel.s;else{for(i in e){var j;"literal"===e[i].otype&&(void 0===j&&(j=""),j+=e[i].o+" ")}displayuri=e[0].s,void 0===j&&(j=e[0].s),j.trim()}var k=_.where(e,{p:c[0].propertyURI}),l={tguid:k[0].guid,tlabelhover:j,tlabel:j,tlabelURI:displayuri,fobjectid:a,inputid:d,triples:e},n=m(l);$(h).append(n),void 0!==c[0].repeatable&&"false"==c[0].repeatable&&$("#"+d,f.form).attr("disabled",!0)}}),$("#bfeditor-modalSave-"+b).off("click"),$("#bfeditor-modal-"+b).modal("hide"),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))}function m(a){var b=$("<div>",{id:a.tguid,class:"btn-group btn-group-xs"});_.isUndefined(a.tlabel)?display="example":a.tlabel.length>40?display=a.tlabel.substr(0,40)+"...":display=a.tlabel;var c=$('<button type="button" class="btn btn-default" title="'+a.tlabelhover+'">'+display+"</button>");if(void 0!==a.tlabelURI&&a.tlabelURI.match("^!_:b")&&(c=$('<button type="button" class="btn btn-default" title="'+a.tlabelhover+'"><a href="'+a.tlabelURI+'">'+display+"</a></button>")),b.append(c),void 0===a.editable||!0===a.editable){var d=$('<button class="btn btn-warning" type="button"> <span class="glyphicon glyphicon-pencil"></span></button>');d.click(function(){1===a.triples.length?q(a.fobjectid,a.inputid,a.triples[0]):r(a.fobjectid,a.inputid,a.tguid,a.triples)}),b.append(d)}var e=$('<button class="btn btn-danger" type="button"><span class="glyphicon glyphicon-trash"></span> </button>');return e.click(function(){1===a.triples.length?s(a.fobjectid,a.inputid,a.tguid,a.triples[0]):t(a.fobjectid,a.inputid,a.tguid,a.triples)}),b.append(e),b}function n(a,b,c){var d=_.where(G,{id:a});d=d[0];var e=$("#"+c,d.form).val();if(void 0!==e&&""!==e){var f={};f.guid=u(),d.resourceTemplates.forEach(function(g){var h=_.where(g.propertyTemplates,{guid:c});if(void 0!==h[0]){void 0!==g.defaulturi&&""!==g.defaulturi?f.s=g.defaulturi:f.s=x.baseURI+b,f.p=h[0].propertyURI,f.o=e,f.otype="literal",y.store.push(f),d.store.push(f);var i=$("#"+c,d.form).closest(".form-group"),j=$(i).find(".btn-toolbar")[0],k={tguid:f.guid,tlabel:e,tlabelhover:e,fobjectid:a,inputid:c,triples:[f]},l=m(k);$(j).append(l),$("#"+c,d.form).val(""),void 0!==h[0].repeatable&&"false"==h[0].repeatable&&$("#"+c,d.form).attr("disabled",!0)}})}$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))}function o(a,b,c){var d=_.where(G,{id:a});d=d[0];var e=$("#"+c,d.form).val();if(void 0!==e&&""!==e){var f={};f.guid=u(),d.resourceTemplates.forEach(function(g){var h=_.where(g.propertyTemplates,{guid:c});if(void 0!==h[0]){void 0!==g.defaulturi&&""!==g.defaulturi?f.s=g.defaulturi:f.s=x.baseURI+b,f.p=h[0].propertyURI,f.o=e,f.otype="uri",y.store.push(f),d.store.push(f);var i=$("#"+c,d.form).closest(".form-group"),j=i.find(".btn-toolbar")[0],k={tguid:f.guid,tlabel:f.o,tlabelhover:f.o,fobjectid:a,inputid:c,triples:[f]},l=m(k);$(j).append(l),$("#"+c,d.form).val(""),void 0!==h[0].repeatable&&"false"==h[0].repeatable&&$("#"+c,d.form).attr("disabled",!0)}})}$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))}function p(a){var b=($(a).closest("form").eq(0),$(a).closest("form").eq(0).attr("id")),c=$(a).siblings(".typeaheadpage").attr("id");b=b.replace("bfeditor-form-","");var d=_.where(G,{id:b});d=d[0],void 0!==c&&(d.pageid=c);var e,f=$(a).attr("data-propertyguid");d.resourceTemplates.forEach(function(a){var b=_.where(a.propertyTemplates,{guid:f});void 0!==b[0]&&(e=b[0])});var g=e.valueConstraint.useValuesFrom,h=[];g.forEach(function(a){var b=H[a];z.addMsg(new Error,"DEBUG","Setting typeahead scheme: "+a),z.addMsg(new Error,"DEBUG","Lookup is",b);var c={};c.name=b.name,c.source=function(a,c){b.load.source(a,c,d)},c.templates={header:"<h3>"+b.name+"</h3>",footer:'<div id="dropdown-footer" class=".col-sm-1"></div>'},c.displayKey="value",h.push(c)}),z.addMsg(new Error,"DEBUG","Data source hashes",h);var i={minLength:0,highlight:!0,displayKey:"value"};1===h.length?$(a).typeahead(i,h[0]):2===h.length?$(a).typeahead(i,h[0],h[1]):3===h.length?$(a).typeahead(i,h[0],h[1],h[2]):4===h.length?$(a).typeahead(i,h[0],h[1],h[2],h[3]):5===h.length?$(a).typeahead(i,h[0],h[1],h[2],h[3],h[4]):6===h.length&&$(a).typeahead(i,h[0],h[1],h[2],h[3],h[4],h[5]),$(a).on("typeahead:selected",function(b,c,d){z.addMsg(new Error,"DEBUG","Typeahead selection made");var e=$("#"+b.target.id).closest("form").eq(0),f=$("#"+b.target.id).closest("form").eq(0).attr("id");f=f.replace("bfeditor-form-",""),$(a).parent().siblings(".typeaheadpage").val(1);var g=$(e).children("div").eq(0).attr("id"),h=$(e).find("div[data-uri]").eq(0).attr("data-uri"),i=$("#"+b.target.id).attr("data-propertyguid");z.addMsg(new Error,"DEBUG","propertyguid for typeahead input is "+i);var j=(x.baseURI,""),k=_.where(G,{id:f});k=k[0],k.resourceTemplates.forEach(function(a){var b=_.where(a.propertyTemplates,{guid:i});void 0!==b[0]&&(j=b[0])});var l,n=_.where(H,{name:d});void 0!==n[0]&&(z.addMsg(new Error,"DEBUG","Found lookup for datasetname: "+d,n[0]),l=n[0].load),l.getResource(h,j.propertyURI,c,function(a){z.addMsg(new Error,"DEBUG","Triples returned from lookup's getResource func:",a),a.forEach(function(b){if(void 0===b.guid){var c=u();b.guid=c}k.store.push(b),y.store.push(b),b.s==h&&k.resourceTemplates.forEach(function(c){var d=_.where(c.propertyTemplates,{propertyURI:b.p});if(void 0!==d[0]){var e=d[0],f=e.guid,g=$("#"+f,k.form).closest(".form-group"),h=g.find(".btn-toolbar")[0],i=b.o;if("uri"==b.otype){var j=_.where(a,{s:b.o}),l=_.filter(a,function(a){return a.s.match("^_:b")});j=j.concat(l);var n=_.find(j,function(a){return a.p.match(/label|^title$|titleValue/i)});if(void 0!==n&&void 0!==n.o&&n.o.match("^_:b")){var o=_.where(a,{s:b.s}),n=_.find(o,function(a){return a.p.match(/label|authorizedAccessPoint/i)});i=n.o}else void 0!==n&&void 0!==n.o&&(i=n.o)}var p=[b];void 0!==j&&void 0!==j[0]&&(p=j);var q=!0;void 0!==e.valueConstraint.editable&&"false"===e.valueConstraint.editable&&(q=!1);var r={editable:q,tguid:b.guid,tlabel:i,tlabelhover:i,fobjectid:k.id,inputid:f,triples:p},s=m(r);if($(h).append(s),$("#"+f,k.form).val(""),$("#"+f,k.form).typeahead("val",""),$("#"+f,k.form).typeahead("close"),void 0!==e.valueConstraint&&void 0!==e.valueConstraint.repeatable&&"false"==e.valueConstraint.repeatable){var t=$("#"+f,k.form);if(t.is("input"))t.prop("disabled",!0),t.css("background-color","#EEEEEE");else{$("div.btn-group",t).find("button").each(function(){$(this).prop("disabled",!0)})}}}})}),y.storeDedup(),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))})})}function q(a,b,c){var d=_.where(G,{id:a});d=d[0],z.addMsg(new Error,"DEBUG","Editing triple: "+c.guid,c),$("#"+c.guid).empty();var e=$("#"+b,d.form);if(e.is("input")&&e.hasClass("typeahead")){$("#"+b,d.form).parent().find("input[data-propertyguid='"+b+"']").each(function(){$(this).prop("disabled",!1),$(this).removeAttr("disabled"),$(this).css("background-color","transparent")})}else if(e.is("input"))e.prop("disabled",!1),e.removeAttr("disabled");else{var f=$("div.btn-group",e).find("button");f.each(function(){$(this).prop("disabled",!1)})}e.is("input")&&"literal"==c.otype&&e.val(c.o),d.store=_.without(d.store,_.findWhere(d.store,{guid:c.guid})),y.store=_.without(y.store,_.findWhere(y.store,{guid:c.guid})),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))}function r(a,b,c,d){z.addMsg(new Error,"DEBUG","Editing triples",d);var e=_.where(d,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});if(void 0==e[0]&&(e=_.where(d,{p:"@type"})),z.addMsg(new Error,"DEBUG","Triples represent these resourceTypes",e),void 0!==e[0]&&void 0!==typeof e[0]&&void 0!==e[0].rtID){var f=_.where(G,{id:a});f=f[0];var g=_.where(B,{id:e[0].rtID});void 0!==g[0]&&(z.addMsg(new Error,"DEBUG","Opening modal for editing",d),j(f.id,g[0],e[0].s,b,d))}else t(a,b,c,d)}function s(a,b,c,d){var e=_.where(G,{id:a});e=e[0],$("#"+d.guid).length&&void 0!==d?(z.addMsg(new Error,"DEBUG","Removing triple: "+d.guid,d),$("#"+d.guid).remove()):(z.addMsg(new Error,"DEBUG","Removing triple: "+c),$("#"+c).remove(),e.store=_.without(e.store,_.findWhere(e.store,{guid:c})),y.store=_.without(y.store,_.findWhere(y.store,{guid:c})));var f=$("#"+b,e.form);if(f.is("input")&&f.hasClass("typeahead")){$("#"+b,e.form).parent().find("input[data-propertyguid='"+b+"']").each(function(){$(this).prop("disabled",!1),$(this).removeAttr("disabled"),$(this).css("background-color","transparent")})}else if(f.is("input"))f.prop("disabled",!1),f.removeAttr("disabled");else{var g=$("div.btn-group",f).find("button");g.each(function(){$(this).prop("disabled",!1)})}e.store=_.without(e.store,_.findWhere(e.store,{guid:d.guid})),y.store=_.without(y.store,_.findWhere(y.store,{guid:d.guid})),$("#bfeditor-debug").html(JSON.stringify(y.store,void 0," "))}function t(a,b,c,d){z.addMsg(new Error,"DEBUG","Removing triples for formobjectID: "+a+" and inputID: "+b,d),d.forEach(function(d){s(a,b,c,d)})}function u(){function a(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c=0;c<1;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}return a()+a()+a()+parseInt(Date.now()/1e3)}function v(a,b){var c="_:bnode";return $.ajax({type:"GET",async:!1,cache:!0,dataType:"json",contentType:"application/json",url:a.resourceURI+".json",success:function(d){d.some(function(d){if(d["@id"]===a.resourceURI){if("http://bibframe.org/vocab/Work"===d["http://www.w3.org/2000/01/rdf-schema#subClassOf"][0]["@id"]||"http://bibframe.org/vocab/Work"===d["@id"])return c=b+"resources/works/";if("http://bibframe.org/vocab/Instance"===d["http://www.w3.org/2000/01/rdf-schema#subClassOf"][0]["@id"]||"http://bibframe.org/vocab/Instance"===d["@id"])return c=b+"resources/instances/"}})},error:function(a,b,c){z.addMsg(new Error,"ERROR","Request status: "+b+"; Error msg: "+c)}}),c}a("src/lib/jquery-2.1.0.min"),a("src/lib/json"),a("src/lib/lodash.min"),a("src/lib/bootstrap.min"),a("src/lib/typeahead.jquery.min");var w,x={},y=a("src/bfestore"),z=a("src/bfelogging"),A=[],B=[],C=1,D=[],E=0,F=0,G=[],H={"http://id.loc.gov/authorities/names":{name:"LCNAF",load:a("src/lookups/lcnames")},"http://id.loc.gov/authorities/subjects":{name:"LCSH",load:a("src/lookups/lcsubjects")},"http://id.loc.gov/authorities/genreForms":{name:"LCGFT",load:a("src/lookups/lcgenreforms")},"http://id.loc.gov/resources/works":{name:"LC-Works",load:a("src/lookups/lcworks")},"http://id.loc.gov/resources/instances":{name:"LC-Instances",load:a("src/lookups/lcinstances")},"http://id.loc.gov/vocabulary/organizations":{name:"Organizations",load:a("src/lookups/lcorganizations")},"http://id.loc.gov/vocabulary/countries":{name:"Countries",load:a("src/lookups/lccountries")},"http://id.loc.gov/vocabulary/geographicAreas":{name:"GeographicAreas",load:a("src/lookups/lcgacs")},"http://id.loc.gov/vocabulary/languages":{name:"Languages",load:a("src/lookups/lclanguages")},"http://id.loc.gov/vocabulary/identifiers":{name:"Identifiers",load:a("src/lookups/lcidentifiers")},"http://id.loc.gov/vocabulary/targetAudiences":{name:"Audiences",load:a("src/lookups/lctargetaudiences")},"http://id.loc.gov/vocabulary/iso639-1":{name:"ISO639-1",load:a("src/lookups/iso6391")},"http://id.loc.gov/vocabulary/iso639-2":{name:"ISO639-2",load:a("src/lookups/iso6392")},"http://id.loc.gov/vocabulary/iso639-5":{name:"ISO639-5",load:a("src/lookups/iso6395")},"http://id.loc.gov/vocabulary/contentTypes":{name:"RDA-Content-Types",load:a("src/lookups/rdacontenttypes")},"http://id.loc.gov/vocabulary/mediaTypes":{name:"RDA-Media-Types",load:a("src/lookups/rdamediatypes")},"http://id.loc.gov/vocabulary/carriers":{name:"RDA-Carriers",load:a("src/lookups/rdacarriers")},"http://id.loc.gov/ml38281/vocabulary/rda/ModeIssue":{name:"RDA-Mode-of-Issuance",load:a("src/lookups/rdamodeissue")},"http://id.loc.gov/vocabulary/relators":{name:"RDA-Relators",load:a("src/lookups/lcrelators")},"http://id.loc.gov/authorities/performanceMediums":{name:"Performance-Mediums",load:a("src/lookups/lcperformanceMediums")},"http://id.loc.gov/ml38281/vocabulary/rda/MusNotation":{name:"RDA-Form-Musical-Notation",load:a("src/lookups/rdamusnotation")},"http://rdaregistry.info/termList/FormatNoteMus":{name:"RDA-Format-Musical-Notation",load:a("src/lookups/rdaformatnotemus")}};b.aceconfig=a("src/lib/aceconfig"),b.require=a,b.setConfig=function(b){x=b,z.init(x);for(var c=0;c<b.profiles.length;c++)file=b.profiles[c],z.addMsg(new Error,"INFO","Loading profile: "+b.profiles[c]),$.ajax({type:"GET",dataType:"json",async:!1,url:file,success:function(a){$("#bfeditor-loader").width($("#bfeditor-loader").width()+5+"%"),A.push(a);for(var b=0;b<a.Profile.resourceTemplates.length;b++)B.push(a.Profile.resourceTemplates[b])},error:function(a,b,c){z.addMsg(new Error,"ERROR","FAILED to load profile: "+file),z.addMsg(new Error,"ERROR","Request status: "+b+"; Error msg: "+c)}});if(void 0!==b.lookups){E+=Object.keys(b.lookups).length;for(k in b.lookups){var e=b.lookups[k];z.addMsg(new Error,"INFO","Loading lookup: "+e.load),a([e.load],function(a){d(a)})}}void 0===x.baseURI&&(x.baseURI=window.location.protocol+"//"+window.location.host+"/"),z.addMsg(new Error,"INFO","baseURI is "+x.baseURI),void 0!==b.load&&(E+=b.load.length,b.load.forEach(function(a){var b=u(),c={},d=[];c.templateGUID=b,c.resourceTemplateID=a.templateID,c.resourceURI=a.defaulturi,c.embedType="page",c.data=d,D.push(c),void 0!==a.source&&void 0!==a.source.location&&void 0!==a.source.requestType?$.ajax({url:a.source.location,dataType:a.source.requestType,success:function(b){z.addMsg(new Error,"INFO","Fetched external source baseURI"+a.source.location),z.addMsg(new Error,"DEBUG","Source data",b),d=y.jsonld2store(b),d.forEach(function(b){"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==b.p&&"uri"==b.otype&&b.s==a.defaulturi.replace("ml38281/","")&&(b.rtID=a.templateID)}),c.data=d,f()},error:function(b,c,d){z.addMsg(new Error,"ERROR","FAILED to load external source: "+a.source.location),z.addMsg(new Error,"ERROR","Request status: "+c+"; Error msg: "+d)}}):f()}))},b.fulleditor=function(a,b){w=document.getElementById(b);var c=$("<div>",{id:"bfeditor-menudiv",class:"col-md-2 sidebar"}),d=$("<div>",{id:"bfeditor-formdiv",class:"col-md-10 main"}),e=$("<div>",{class:"row"}),f=$('<div><br /><br /><h2>Loading...</h2><div class="progress progress-striped active">                        <div class="progress-bar progress-bar-info" id="bfeditor-loader" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 20%">                            <span class="sr-only">80% Complete</span>                        </div>                    </div>');d.append(f),c.append("<h3>Create Resource</h3"),e.append(c),d.append("<h2>Dashboard</h2>",{class:"page-header"}),e.append(d),$(w).append(e),this.setConfig(a);for(var h=0;h<a.startingPoints.length;h++){var i=a.startingPoints[h],j=$("<ul>",{class:"nav nav-sidebar"});void 0!==typeof i.menuGroup&&""!==i.menuGroup&&($menuheading=$('<li><a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">'+i.menuGroup+'<span class="caret"></span></a></li>'),$menuheadingul=$('<ul class="dropdown-menu"></ul>'),$menuheading.append($menuheadingul),j.append($menuheading));for(var k=0;k<i.menuItems.length;k++){var l=$("<li>"),m=$("<a>",{href:"#",id:"sp-"+h+"_"+k});m.html(i.menuItems[k].label),m.click(function(){g(this.id)}),l.append(m),null!==$menuheadingul?$menuheadingul.append(l):j.append(l)}c.append(j)}if(void 0!==x.logging&&void 0!==x.logging.level&&"DEBUG"==x.logging.level){var n=$('<div id="bfeditor-debugdiv" class="col-md-12 main panel-group">                         <div class="panel panel-default"><div class="panel-heading">                         <h3 class="panel-title"><a role="button" data-toggle="collapse" href="#debuginfo">Debug output</a></h3></div>                         <div class="panel-collapse collapse in" id="debuginfo"><div class="panel-body"><pre id="bfeditor-debug"></pre></div></div></div>                         </div>');$(w).append(n);$("#bfeditor-debug").html(JSON.stringify(A,void 0," "))}var o=$("<footer>",{class:"footer"});return $(w).append(o),0===E&&d.html(""),{profiles:A,div:w,bfestore:y,bfelog:z}},b.editor=function(a,b){this.setConfig(a),w=document.getElementById(b);var c=$("<div>",{id:"bfeditor-formdiv",class:"col-md-12"}),d=$("<div>",{class:"row"});if(d.append(c),$(w).append(d),void 0!==x.logging&&void 0!==x.logging.level&&"DEBUG"==x.logging.level){var e=$("<div>",{class:"col-md-12"});e.html("Debug output");var f=$("<pre>",{id:"bfeditor-debug"});e.append(f),$(w).append(e),f.html(JSON.stringify(A,void 0," "))}var g=$("<div>",{class:"col-md-12"});return $(w).append(g),{profiles:A,div:w,bfestore:y,bfelog:z}}}),bfe.define("src/bfestore",["require","exports","module","src/lib/lodash.min"],function(a,b,c){function d(){function a(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c=0;c<1;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}return a()+a()+a()+parseInt(Date.now()/1e3)}a("src/lib/lodash.min"),b.store=[],b.storeDedup=function(){return b.store=_.uniq(b.store,function(a){return void 0!==a.olang?a.s+a.p+a.o+a.otype+a.olang:void 0!==a.odatatype?a.s+a.p+a.o+a.otype+a.odatatype:a.s+a.p+a.o+a.otype}),b.store},b.jsonld2store=function(a){return a.forEach(function(a){var c=void 0!==a["@id"]?a["@id"]:"_:b"+d();for(var e in a)"@id"!==e&&a[e].forEach(function(a){var f=d(),g={};g.guid=f,g.s=c,g.p=e,void 0!==a["@id"]?(g.o=a["@id"],g.otype="uri"):void 0!==a["@value"]&&(g.o=a["@value"],g.otype="literal",void 0!==a["@language"]&&(g.olang=a["@language"])),b.store.push(g)})}),b.store},b.store2jsonldExpanded=function(){var a=[];b.storeDedup(),groupedResources=_.groupBy(b.store,function(a){return a.s});for(var c in groupedResources){var d={};d["@id"]=c,groupedProperties=_.groupBy(groupedResources[c],function(a){return a.p});for(var e in groupedProperties){var f=e;"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"==e&&(f="@type"),d[f]=[],groupedProperties[e].forEach(function(a){if("@type"==f&&"uri"==a.otype)d[f].push(a.o);else if("uri"==a.otype)d[f].push({"@id":a.o});else{var b={};void 0!==a.olang&&""!==a.olang&&(b["@language"]=a.olang),"@type"==a.p?b=a.o:b["@value"]=a.o,d[f].push(b)}})}a.push(d)}return a},b.store2text=function(){var a="\n",c=a+"\t",d=a+"\t\t",e="";return b.store2jsonldExpanded().forEach(function(b){e+=a+"ID: "+b["@id"],void 0!==b["@type"]&&(e+=c+"Type(s)",b["@type"].forEach(function(a){void 0!==a["@value"]?e+=d+a["@value"]:e+=d+a}));for(var f in b)if("@type"!==f&&"@id"!==f){var g=f.replace("http://bibframe.org/vocab/","bf:");g=g.replace("http://id.loc.gov/vocabulary/relators/","relators:"),g=g.replace("http://bibframe.org/vocab2/","bf2:"),g=g.replace("http://rdaregistry.info/termList/","rda"),e+=c+g,b[f].forEach(function(a){void 0!==a["@id"]?e+=d+a["@id"]:e+=d+a["@value"]})}e+=a+a}),e}}),bfe.define("src/bfelogging",["require","exports","module"],function(a,b,c){function d(a,b,c,d){g&&(console.log(c.fileName+":"+c.lineNumber+" -> "+b),("object"==typeof b||b instanceof Array)&&console.log(b),void 0!==d&&("object"==typeof d||d instanceof Array)&&console.log(d))}function e(a,c,d,e){var f=new Date,g=f.toJSON(),h=f.toLocaleString(),i={};i.dt=f,i.dtLocaleSort=g,i.dtLocaleReadable=h,i.type=a,i.fileName=d.fileName,i.lineNumber=d.lineNumber,"object"==typeof c||c instanceof Array?i.msg=JSON.stringify(c):i.msg=c,void 0!==e&&("object"==typeof e||e instanceof Array)&&(i.obj=JSON.stringify(e)),b.log.push(i)}var f="INFO",g=!0,h=window.location.protocol+"//"+window.location.host+"/";b.log=[],b.getLog=function(){return b.log},b.init=function(a){void 0!==a.logging&&(void 0!==a.logging.level&&"DEBUG"==a.logging.level&&(f=a.logging.level),void 0===a.logging.toConsole||a.logging.toConsole||(g=a.logging.toConsole));var c="Logging instantiated: level is "+f+"; log to console is set to "+g;b.addMsg(new Error,"INFO",c),b.addMsg(new Error,"INFO",h)},b.addMsg=function(a,b,c,g){if(void 0===a.lineNumber&&void 0===a.fileName)try{var i=a.stack.split("\n"),j=i[1].substring(i[1].indexOf("(")+1);j=j.replace(h,"");var k=j.split(":");a.fileName=k[0],a.lineNumber=k[1]}catch(b){a.fileName="unknown",a.lineNumber="?"}a.fileName=a.fileName.replace(h,""),"INFO"==f&&b.match(/INFO|WARN|ERROR/)?(e(b,c,a,g),d(b,c,a,g)):"DEBUG"==f&&(e(b,c,a,g),d(b,c,a,g))}}),bfe.define("src/lookups/lcnames",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/authorities/names",b.source=function(a,c,f){var g=f.store,h="",i=_.where(g,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==i[0]&&(h=i[0].o);var j="http://id.loc.gov/authorities/names";i=_.where(g,{p:"http://bibframe.org/vocab/authoritySource"}),void 0!==i[0]&&(console.log(i[0]),j=i[0].o);var k="";"http://bibframe.org/vocab/Person"==h?k="rdftype:PersonalName":"http://bibframe.org/vocab/Topic"==h?k="(rdftype:Topic OR rdftype:ComplexSubject)":"http://bibframe.org/vocab/Place"==h?k="rdftype:Geographic":"http://bibframe.org/vocab/Organization"==h?k="rdftype:CorporateName":"http://bibframe.org/vocab/Family"==h?k="rdftype:PersonalName":"http://bibframe.org/vocab/Meeting"==h?k="rdftype:ConferenceName":"http://bibframe.org/vocab/Jurisdiction"==h?k="rdftype:CorporateName":"http://bibframe.org/vocab/GenreForm"==h&&(k="rdftype:GenreForm");var l="";if(""!==j&&""!==k?l="cs:"+j+" AND "+k:""!==k?l=k:""!==j&&(l="cs:"+j),l=""!==l?l+" AND ("+a+" OR "+a+"* OR *"+a+"*)":"("+a+" OR "+a+"* OR *"+a+"*)",l=encodeURI(l),e[l])return void c(e[l]);void 0!==this.searching&&(clearTimeout(this.searching),c([])),this.searching=setTimeout(function(){if(a.length>2&&"?"!=a.substr(0,1))suggestquery=a,""!==k&&(suggestquery+="&rdftype="+k.replace("rdftype:","")),u=b.scheme+"/suggest/?q="+suggestquery+"&count=50",$.ajax({url:u,dataType:"jsonp",success:function(b){return parsedlist=d.processSuggestions(b,a),e[l]=parsedlist,c(parsedlist)}});else{if(!(a.length>2))return[];u="http://id.loc.gov/search/?format=jsonp&start=1&count=50&q="+l.replace("?",""),$.ajax({url:u,dataType:"jsonp",success:function(b){return parsedlist=d.processATOM(b,a),e[l]=parsedlist,c(parsedlist)}})}},300)},b.getResource=d.getResourceWithAAP}),bfe.define("src/lookups/lcshared",["require","exports","module"],function(a,b,c){a("https://twitter.github.io/typeahead.js/releases/latest/typeahead.bundle.js"),b.getResource=function(a,b,c,d){var e=[],f={};return f.s=a,f.p=b,c.uri=c.uri,f.o=c.uri,f.otype="uri",e.push(f),f={},f.s=c.uri,f.p="http://bibframe.org/vocab/label",f.o=c.value,f.otype="literal",f.olang="en",e.push(f),d(e)},b.getResourceWithAAP=function(a,b,c,d){var e=[],f={};f.s=a,f.p=b,f.o=c.uri,f.otype="uri",e.push(f),f={},f.s=a,f.p="http://bibframe.org/vocab/authorizedAccessPoint",f.o=c.value,f.otype="literal",f.olang="en",e.push(f),f={},f.s=a,f.p="http://bibframe.org/vocab/label",f.o=c.value,f.otype="literal",f.olang="en",e.push(f),d(e)},b.getResourceLabelLookup=function(a,b,c,d){var e=[],f={};f.s=a,f.p=b,f.o=c.uri,f.otype="uri",e.push(f),$.ajax({url:c.uri+".jsonp",dataType:"jsonp",success:function(a){a.forEach(function(a){if(a["@id"]===c.uri){var b={};return b.s=c.uri,b.otype="literal",b.p="http://bibframe.org/vocab/label",b.o=a["http://www.loc.gov/standards/mads/rdf/v1#authoritativeLabel"][0]["@value"],e.push(b),d(e)}})}})},b.processJSONLDSuggestions=function(a,b,c){var d=[];if(void 0!==a["@graph"])for(var e=0;e<a["@graph"].length;e++)if(void 0!==a["@graph"][e]["skos:inScheme"]&&"skos:Concept"===a["@graph"][e]["@type"]&&a["@graph"][e]["skos:inScheme"]["@id"]===c){if(void 0!==a["@graph"][e]["skos:prefLabel"].length){for(var f=0;f<a["@graph"][e]["skos:prefLabel"].length;f++)if("en"===a["@graph"][e]["skos:prefLabel"][f]["@language"]){var g=a["@graph"][e]["skos:prefLabel"][f]["@value"];break}}else var g=a["@graph"][e]["skos:prefLabel"]["@value"];var h=a["@graph"][e]["@id"];d.push({uri:h,value:g})}return 0===d.length&&(d[0]={uri:"",value:"[No suggestions found for "+b+".]"}),d},b.processSuggestions=function(a,b){var c=[];if(void 0!==a[1])for(var d=0;d<a[1].length;d++){var e=a[1][d],f=a[3][d];c.push({uri:f,value:e})}return 0===c.length&&(c[0]={uri:"",value:"[No suggestions found for "+b+".]"}),c},b.processATOM=function(a,b){var c=[];for(var d in a)if("atom:entry"==a[d][0]){var e="",f="",g="";for(var h in a[d])if("atom:title"==a[d][h][0]&&(e=a[d][h][2]),"atom:link"==a[d][h][0]&&(f=a[d][h][1].href,g=f.substr(0,f.lastIndexOf("/"))),""!==e&&""!==f){c.push({uri:f,source:g,value:e});break}}return 0===c.length&&(c[0]={uri:"",value:"[No suggestions found for "+b+".]"}),c},b.simpleQuery=function(a,c,d,e){if(console.log("q is "+a),q=encodeURI(a),c[q])return void e(c[q]);void 0!==this.searching&&(clearTimeout(this.searching),e([])),this.searching=setTimeout(function(){if(""===a||" "===a)u=d+"/suggest/?count=100&q=",$.ajax({url:u,dataType:"jsonp",success:function(a){return parsedlist=b.processSuggestions(a,""),e(parsedlist)}});else{if(!(a.length>=1))return[];u=d+"/suggest/?q="+q,$.ajax({url:u,dataType:"jsonp",success:function(d){return parsedlist=b.processSuggestions(d,a),c[q]=parsedlist,e(parsedlist)}})}},300)}}),bfe.define("src/lookups/lcsubjects",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/authorities/subjects",b.source=function(a,c,f){var g=f.store,h="",i=_.where(g,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==i[0]&&(h=i[0].o);var j="http://id.loc.gov/authorities/subjects";i=_.where(g,{p:"http://bibframe.org/vocab/authoritySource"}),void 0!==i[0]&&(j=i[0].o);var k="";"http://bibframe.org/vocab/Person"==h?k="rdftype:PersonalName":"http://bibframe.org/vocab/Topic"==h?k="(rdftype:Topic OR rdftype:ComplexSubject)":"http://bibframe.org/vocab/Place"==h?k="rdftype:Geographic":"http://bibframe.org/vocab/Organization"==h?k="rdftype:CorporateName":"http://bibframe.org/vocab/Family"==h?k="rdftype:PersonalName":"http://bibframe.org/vocab/Meeting"==h?k="rdftype:ConferenceName":"http://bibframe.org/vocab/Jurisdiction"==h?k="rdftype:CorporateName":"http://bibframe.org/vocab/GenreForm"==h&&(k="rdftype:GenreForm");var l="";if(""!==j&&""!==k?l="cs:"+j+" AND "+k:""!==k?l=k:""!==j&&(l="cs:"+j),l=""!==l?l+" AND ("+a+" OR "+a+"* OR *"+a+"*)":"("+a+" OR "+a+"* OR *"+a+"*)",l=encodeURI(l),e[l])return void c(e[l]);void 0!==this.searching&&(clearTimeout(this.searching),c([])),this.searching=setTimeout(function(){if(a.length>2&&"?"!=a.substr(0,1))suggestquery=a,""!==k&&(suggestquery+="&rdftype="+k.replace("rdftype:","")),u=b.scheme+"/suggest/?q="+suggestquery,$.ajax({url:u,dataType:"jsonp",success:function(b){return parsedlist=d.processSuggestions(b,a),e[l]=parsedlist,c(parsedlist)}});else{if(!(a.length>2))return[];u="http://id.loc.gov/search/?format=jsonp&start=1&count=10&q="+l.replace("?",""),$.ajax({url:u,dataType:"jsonp",success:function(b){return parsedlist=d.processATOM(b,a),e[l]=parsedlist,c(parsedlist)}})}},300)},b.getResource=d.getResourceWithAAP}),bfe.define("src/lookups/lcgenreforms",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/authorities/genreForms",b.source=function(a,b){var c="http://id.loc.gov/authorities/genreForms",f="rdftype:GenreForm",g="";if(""!==c&&""!==f?g="cs:"+c+" AND "+f:""!==f?g=f:""!==c&&(g="cs:"+c),g=""!==g?g+" AND ("+a+" OR "+a+"* OR *"+a+"*)":"("+a+" OR "+a+"* OR *"+a+"*)",console.log("q is "+g),g=encodeURI(g),e[g])return void b(e[g]);void 0!==this.searching&&(console.log("searching defined"),clearTimeout(this.searching),b([])),this.searching=setTimeout(function(){if(!(a.length>2))return[];suggestquery=a,""!==f&&(suggestquery+="&rdftype="+f.replace("rdftype:","")),u=c+"/suggest/?q="+suggestquery,$.ajax({url:u,dataType:"jsonp",success:function(c){return parsedlist=d.processSuggestions(c,a),e[g]=parsedlist,b(parsedlist)}})},300)},b.getResource=d.getResourceWithAAP}),bfe.define("src/lookups/lcworks",["require","exports","module"],function(a,b,c){function d(a,b){var c=[];for(var d in a)if("atom:entry"==a[d][0]){var e="",f="",g="";for(var h in a[d])if("atom:title"==a[d][h][0]&&(e=a[d][h][2]),"atom:link"==a[d][h][0]&&(f=a[d][h][1].href,g=f.substr(0,f.lastIndexOf("/"))),""!==e&&""!==f){c.push({uri:f,source:g,value:e});break}}return 0===c.length&&(c[0]={uri:"",value:"[No suggestions found for "+b+".]"}),c}var e=[];b.scheme="http://id.loc.gov/resources/works",b.source=function(a,b,c){var f=$("#"+c.pageid),g=void 0!=f.val()?parseInt(f.val()):1,h=c.store,i=_.where(h,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==i[0]&&i[0].o;var j="http://id.loc.gov/resources/works";i=_.where(h,{p:"http://bibframe.org/vocab/authoritySource"}),void 0!==i[0]&&(console.log(i[0]),j=i[0].o);var k="",l="";if(""!==j&&""!==k?l="cs:"+j+"&q="+k:""!==k?l=k:""!==j&&(l="cs:"+j),l=l+"&q=scheme:/bibframe&q="+a,l=encodeURI(l),e[l])return void b(e[l]);void 0!==this.searching&&(clearTimeout(this.searching),b([])),this.searching=setTimeout(function(c){if(!(a.length>2))return[];u="http://id.loc.gov/ml38281/search/?format=jsonp&start=1&count=50&q="+l,$.ajax({url:u,dataType:"jsonp",success:function(c){return f.val(g+10),parsedlist=d(c,a),e[l]=parsedlist,b(parsedlist)}})},300)},b.getResource=function(a,b,c,d){var e=[],f={};f.s=a,f.p=b,f.o=c.uri,f.otype="uri",e.push(f),f={},f.s=a,f.p="http://bibframe.org/vocab/authorizedAccessPoint",f.o=c.value,f.otype="literal",f.olang="en",e.push(f),f={},f.s=c.uri,f.p="http://bibframe.org/vocab/label",f.o=c.value,f.otype="literal",f.olang="en",e.push(f);var g=c.uri.replace(/gov\/resources/,"gov/ml38281/resources")+".bibframe_raw.jsonp";c.uri;$.ajax({url:g,dataType:"jsonp",success:function(a){a.forEach(function(a){var b=a["@id"];for(var c in a)"@id"!==c&&a[c].forEach(function(a){var d={};d.s=b,d.p=c,void 0!==a["@id"]?(d.o=a["@id"],d.otype="uri"):void 0!==a["@value"]?(d.o=a["@value"],d.otype="literal",void 0!==a["@language"]&&(d.olang=a["@language"])):d.o=a,e.push(d)})}),d(e)}})}}),bfe.define("src/lookups/lcinstances",["require","exports","module"],function(a,b,c){function d(a,b){var c=[];for(var d in a)if("atom:entry"==a[d][0]){var e="",f="",g="";for(var h in a[d])if("atom:title"==a[d][h][0]&&(e=a[d][h][2]),"atom:link"==a[d][h][0]&&(f=a[d][h][1].href,g=f.substr(0,f.lastIndexOf("/"))),""!==e&&""!==f){c.push({uri:f,source:g,value:e});break}}return 0===c.length&&(c[0]={uri:"",value:"[No suggestions found for "+b+".]"}),c}var e=[];b.scheme="http://id.loc.gov/resources/instances",b.source=function(a,b,c){var f=c.store,g=_.where(f,{p:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type"});void 0!==g[0]&&(console.log(g[0]),g[0].o);var h="http://id.loc.gov/ml38281/resources/instances";g=_.where(f,{p:"http://bibframe.org/vocab/authoritySource"}),void 0!==g[0]&&(console.log(g[0]),h=g[0].o);var i="",j="";if(""!==h&&""!==i?j="cs:"+h+"&q="+i:""!==i?j=i:""!==h&&(j="cs:"+h),j=j+"&q=scheme:/bibframe&q="+a,j=encodeURI(j),e[j])return void b(e[j]);void 0!==this.searching&&(clearTimeout(this.searching),b([])),this.searching=setTimeout(function(){if(!(a.length>2))return[];u="http://id.loc.gov/ml38281/search/?format=jsonp&start=1&count=10&q="+j,$.ajax({url:u,dataType:"jsonp",success:function(c){return parsedlist=d(c,a),e[j]=parsedlist,b(parsedlist)}})},300)},b.getResource=function(a,b,c,d){var e=[],f={};f.s=a,f.p=b,f.o=c.uri,f.otype="uri",e.push(f),f={},f.s=a,f.p="http://bibframe.org/vocab/authorizedAccessPoint",f.o=c.value,f.otype="literal",f.olang="en",e.push(f);var g=c.uri.replace(/gov\/resources/,"gov/ml38281/resources")+".bibframe_raw.jsonp";c.uri;$.ajax({url:g,dataType:"jsonp",success:function(a){a.forEach(function(a){var b=a["@id"];for(var c in a)"@id"!==c&&a[c].forEach(function(a){var d={};d.s=b,d.p=c,void 0!==a["@id"]?(d.o=a["@id"],d.otype="uri"):void 0!==a["@value"]&&(d.o=a["@value"],d.otype="literal",void 0!==a["@language"]&&(d.olang=a["@language"])),e.push(d)})}),console.log(e),d(e)}})}}),bfe.define("src/lookups/lcorganizations",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/organizations",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResourceWithAAP}),bfe.define("src/lookups/lccountries",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/countries",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/lcgacs",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/geographicAreas",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/lclanguages",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/languages",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/lcidentifiers",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/identifiers",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/lctargetaudiences",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/targetAudiences",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/iso6391",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/iso639-1",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/iso6392",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/iso639-2",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/iso6395",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/iso639-5",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/rdacontenttypes",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/contentTypes",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/rdamediatypes",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/mediaTypes",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/rdacarriers",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/carriers",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/rdamodeissue",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/ml38281/vocabulary/rda/ModeIssue",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=function(a,b,c,e){return c.uri=c.uri.replace("gov/","gov/ml38281/"),d.getResource(a,b,c,e)}}),bfe.define("src/lookups/rdamusnotation",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/ml38281/vocabulary/rda/MusNotation",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=function(a,b,c,e){return c.uri=c.uri.replace("gov/","gov/ml38281/"),d.getResource(a,b,c,e)}}),bfe.define("src/lookups/rdaformatnotemus",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://rdaregistry.info/termList/FormatNoteMus",b.source=function(a,c){if(console.log("q is "+a),q=encodeURI(a),e[q])return void c(e[q]);void 0!==this.searching&&(clearTimeout(this.searching),c([])),this.searching=setTimeout(function(){if(""===a||" "===a)u=b.scheme+".json-ld",$.ajax({url:u,dataType:"json",success:function(e){return parsedlist=d.processJSONLDSuggestions(e,a,b.scheme),c(parsedlist)}});else{if(!(a.length>1))return[];u=b.scheme+".json-ld",console.log(u),$.ajax({url:u,dataType:"json",success:function(f){return parsedlist=d.processJSONLDSuggestions(f,a,b.scheme),e[q]=parsedlist,c(parsedlist)}})}},300)},b.getResource=d.getResource}),bfe.define("src/lookups/lcrelators",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/vocabulary/relators",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lookups/lcperformanceMediums",["require","exports","module","src/lookups/lcshared"],function(a,b,c){var d=a("src/lookups/lcshared"),e=[];b.scheme="http://id.loc.gov/authorities/performanceMediums",b.source=function(a,c){return d.simpleQuery(a,e,b.scheme,c)},b.getResource=d.getResource}),bfe.define("src/lib/aceconfig",["require","exports","module"],function(a,b,c){function d(d){if(g.packaged=d||a.packaged||c.packaged||f.define&&define.packaged,!f.document)return"";for(var h={},i="",j=document.getElementsByTagName("script"),k=0;k<j.length;k++){var l=j[k],m=l.src||l.getAttribute("src");if(m){for(var n=l.attributes,o=0,p=n.length;o<p;o++){var q=n[o];0===q.name.indexOf("data-ace-")&&(h[e(q.name.replace(/^data-ace-/,""))]=q.value)}var r=m.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);r&&(i=r[1])}}i&&(h.base=h.base||i,h.packaged=!0),h.basePath=h.base,h.workerPath=h.workerPath||h.base,h.modePath=h.modePath||h.base,h.themePath=h.themePath||h.base,delete h.base;for(var s in h)void 0!==h[s]&&b.set(s,h[s])}function e(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})}var f=function(){return this}(),g={packaged:!1,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};b.set=function(a,b){if(!g.hasOwnProperty(a))throw new Error("Unknown config key: "+a);g[a]=b},b.init=d}),function(){bfe.require(["src/bfe"],function(a){console.log(a),a&&a.aceconfig.init(),window.bfe||(window.bfe={});for(var b in a)a.hasOwnProperty(b)&&(bfe[b]=a[b])})}();